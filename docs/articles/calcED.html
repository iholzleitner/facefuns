<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculate similarity of faces • facefuns</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Calculate similarity of faces">
<meta property="og:description" content="facefuns">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">facefuns</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/facefuns.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/calcSD.html">Calculate sexual dimorphism of faces</a>
    </li>
    <li>
      <a href="../articles/calcED.html">Calculate similarity of faces</a>
    </li>
    <li>
      <a href="../articles/calcAsym.html">Calculate asymmetry of faces</a>
    </li>
    <li>
      <a href="../articles/intro3d.html">Working with 3D meshes</a>
    </li>
    <li>
      <a href="../articles/overview.html">facefuns Overview</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/iholzleitner/facefuns/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="calcED_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Calculate similarity of faces</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/iholzleitner/facefuns/blob/master/vignettes/calcED.Rmd"><code>vignettes/calcED.Rmd</code></a></small>
      <div class="hidden name"><code>calcED.Rmd</code></div>

    </div>

    
    
<p><strong>WORK IN PROGRESS</strong></p>
<p>This tutorial will explain how to calculate facial (dis)similarity in a set of 2-D faces. We will calculate the Euclidean distance between Procrustes-aligned landmark templates; to calculate it dissimilarity in face space, replace your matrix of landmark coordinates with the matrix of PC scores.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/iholzleitner/facefuns">facefuns</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/geomorphR/geomorph">geomorph</a></span><span class="op">)</span></code></pre></div>
<div id="read-and-prepare-data" class="section level2">
<h2 class="hasAnchor">
<a href="#read-and-prepare-data" class="anchor"></a>Read and prepare data</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">path_to_tem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"tem"</span>, package<span class="op">=</span><span class="st">"facefuns"</span><span class="op">)</span>

<span class="va">shapedata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/facefuns.html">facefuns</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="../reference/read_lmdata.html">read_lmdata</a></span><span class="op">(</span>lmdata <span class="op">=</span> <span class="va">path_to_tem</span>,
                                         plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,
                      remove_points <span class="op">=</span> <span class="st">"frlgmm"</span>,
                      pc_criterion <span class="op">=</span> <span class="st">"broken_stick"</span>,
                      plot_sample <span class="op">=</span> <span class="cn">FALSE</span>,
                      quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="calculate-facial-similarity" class="section level2">
<h2 class="hasAnchor">
<a href="#calculate-facial-similarity" class="anchor"></a>Calculate facial similarity</h2>
<p>We will use <code><a href="../reference/calc_ed.html">facefuns::calc_ed</a></code> to calculate similarity. <code>calc_ed</code> requires two arguments:</p>
<ol style="list-style-type: decimal">
<li><p>Landmark coordinates (or PC scores) in a matrix format</p></li>
<li><p>A table specifying for which pairs of faces you would like to calculate similarity</p></li>
</ol>
<div id="create-landmark-matrix" class="section level3">
<h3 class="hasAnchor">
<a href="#create-landmark-matrix" class="anchor"></a>Create landmark matrix</h3>
<p>Currently, our landmark templates are stored in a three-dimensional array: a list of <em>n</em> matrices of dimensions <em>p</em> x <em>k</em></p>
<ul>
<li>
<em><strong>p</strong></em> The number of landmarks, here 132</li>
<li>
<em><strong>k</strong></em> The number of landmark dimensions, here 2</li>
<li>
<em><strong>n</strong></em> The number of faces, here 102</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">shapedata</span><span class="op">$</span><span class="va">aligned</span><span class="op">)</span>
<span class="co">#&gt;  num [1:132, 1:2, 1:102] -0.0526 0.054 -0.0522 -0.0603 -0.0622 ...</span>
<span class="co">#&gt;  - attr(*, "dimnames")=List of 3</span>
<span class="co">#&gt;   ..$ : chr [1:132] "1" "2" "3" "4" ...</span>
<span class="co">#&gt;   ..$ : chr [1:2] "X" "Y"</span>
<span class="co">#&gt;   ..$ : chr [1:102] "001" "002" "003" "004" ...</span></code></pre></div>
<p>We will use <code><a href="../reference/convert_array_to_matrix.html">facefuns::convert_array_to_matrix</a></code> to convert our array into a matrix with <em>n</em> rows and <em>p</em> x <em>k</em> columns.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convert_array_to_matrix.html">convert_array_to_matrix</a></span><span class="op">(</span><span class="va">shapedata</span><span class="op">$</span><span class="va">aligned</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">data_matrix</span><span class="op">)</span>
<span class="co">#&gt;  num [1:102, 1:264] -0.0526 -0.0515 -0.0514 -0.0474 -0.0505 ...</span>
<span class="co">#&gt;  - attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   ..$ : chr [1:102] "001" "002" "003" "004" ...</span>
<span class="co">#&gt;   ..$ : chr [1:264] "X1" "Y1" "X2" "Y2" ...</span></code></pre></div>
</div>
<div id="create-list-of-faces" class="section level3">
<h3 class="hasAnchor">
<a href="#create-list-of-faces" class="anchor"></a>Create list of faces</h3>
<p>Most times, you will already have a list of face pairs for which you want to calculate similarity.</p>
<p>For this example, we will calculate the similarity between <em>all</em> possible combinations of face pairs in our data set.</p>
<p>We start by assigning all face IDs in our sample to a variable …</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">face_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span><span class="op">(</span><span class="va">shapedata</span><span class="op">$</span><span class="va">aligned</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<p>… and then create a list of all possible combinations</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pairs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>A <span class="op">=</span> <span class="va">face_names</span>,
                     B <span class="op">=</span> <span class="va">face_names</span><span class="op">)</span></code></pre></div>
</div>
<div id="calc_ed" class="section level3">
<h3 class="hasAnchor">
<a href="#calc_ed" class="anchor"></a><code>calc_ed</code>
</h3>
<p>We now have everything we need to run our function</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sim_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_ed.html">calc_ed</a></span><span class="op">(</span>coords_matrix <span class="op">=</span> <span class="va">data_matrix</span>,
                     pairs_table <span class="op">=</span> <span class="va">pairs</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">sim_table</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 3</span>
<span class="co">#&gt;   A     B     EuclideanDistance</span>
<span class="co">#&gt;   &lt;fct&gt; &lt;fct&gt;             &lt;dbl&gt;</span>
<span class="co">#&gt; 1 001   001              0     </span>
<span class="co">#&gt; 2 002   001              0.0857</span>
<span class="co">#&gt; 3 003   001              0.0663</span>
<span class="co">#&gt; 4 004   001              0.129 </span>
<span class="co">#&gt; 5 005   001              0.112 </span>
<span class="co">#&gt; 6 006   001              0.119</span></code></pre></div>
<p>Let’s display our data in a wide format and round the values. It is a rather big table, so we will only print a small subset</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sim_table</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>EuclideanDistance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">EuclideanDistance</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a></span><span class="op">(</span><span class="va">B</span>, <span class="va">EuclideanDistance</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 9 x 10</span>
<span class="co">#&gt;   A     `001` `002` `003` `004` `005` `006` `007` `008` `009`</span>
<span class="co">#&gt;   &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 001    0     0.09  0.07  0.13  0.11  0.12  0.08  0.14  0.07</span>
<span class="co">#&gt; 2 002    0.09  0     0.07  0.1   0.08  0.08  0.12  0.11  0.11</span>
<span class="co">#&gt; 3 003    0.07  0.07  0     0.1   0.09  0.1   0.09  0.11  0.09</span>
<span class="co">#&gt; 4 004    0.13  0.1   0.1   0     0.09  0.08  0.14  0.11  0.14</span>
<span class="co">#&gt; 5 005    0.11  0.08  0.09  0.09  0     0.1   0.13  0.1   0.12</span>
<span class="co">#&gt; 6 006    0.12  0.08  0.1   0.08  0.1   0     0.14  0.09  0.13</span>
<span class="co">#&gt; 7 007    0.08  0.12  0.09  0.14  0.13  0.14  0     0.16  0.06</span>
<span class="co">#&gt; 8 008    0.14  0.11  0.11  0.11  0.1   0.09  0.16  0     0.15</span>
<span class="co">#&gt; 9 009    0.07  0.11  0.09  0.14  0.12  0.13  0.06  0.15  0</span></code></pre></div>
</div>
</div>
<div id="averageness" class="section level2">
<h2 class="hasAnchor">
<a href="#averageness" class="anchor"></a>Averageness</h2>
<p>Averageness can be quantified as distinctiveness from the sample average. For each face, we will calculate the Euclidean distance to the sample average, and then reverse scores, so higher scores mean “more average”.</p>
<p>You could use <code>calc_ed</code>, but this will require a wee bit of data wrangling: you will need to attach the average template to the array holding the aligned templates, then convert this new array to a matrix and finally reverse the distinctiveness scores. <code>calc_avg</code> does all of that! It only takes one argument - a <code>facefuns</code> object:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">avg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_avg.html">calc_avg</a></span><span class="op">(</span><span class="va">shapedata</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">avg</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 3</span>
<span class="co">#&gt;   id      dist    avg</span>
<span class="co">#&gt;   &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 001   0.0879 0.0597</span>
<span class="co">#&gt; 2 002   0.0650 0.0826</span>
<span class="co">#&gt; 3 003   0.0608 0.0867</span>
<span class="co">#&gt; 4 004   0.0701 0.0774</span>
<span class="co">#&gt; 5 005   0.0700 0.0775</span>
<span class="co">#&gt; 6 006   0.0631 0.0844</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Iris J Holzleitner, Lisa M DeBruine.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
