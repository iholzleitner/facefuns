<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction • facefuns</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction">
<meta property="og:description" content="facefuns">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">facefuns</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/TEMtoTPS.html">Converting Webmorph templates</a>
    </li>
    <li>
      <a href="../articles/calcED.html">Calculate similarity of faces</a>
    </li>
    <li>
      <a href="../articles/intro.html">Introduction</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/iholzleitner/facefuns/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="intro_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="intro_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="intro_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/iholzleitner/facefuns/blob/master/vignettes/intro.Rmd"><code>vignettes/intro.Rmd</code></a></small>
      <div class="hidden name"><code>intro.Rmd</code></div>

    </div>

    
    
<p><strong>WORK IN PROGRESS</strong></p>
<p>This package contains convenience functions for doing shape analyses of 2D and 3D face images in <code>R</code>, as well as tutorials for some common analyses (such as calculating averageness, asymmetry, sexual dimorphism and <a href="./calceED.html">facial similarity</a>).</p>
<p>The following tutorial will provide a quick start to loading 2D face data into R, Procrustes-aligning landmark templates and conducting a principal component analysis of shape using the package <code>geomorph</code>. It will conclude by introducing a function called <code>basics</code>, which will automatically create some of the most commonly used outputs.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/iholzleitner/facefuns">facefuns</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/geomorphR/geomorph">geomorph</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/">tibble</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></pre></div>
<div id="load-data" class="section level2">
<h2 class="hasAnchor">
<a href="#load-data" class="anchor"></a>Load data</h2>
<p>Steps for importing your delineated landmark templates into <code>R</code> will vary depending on the software you used to delineate and the ‘R’ package(s) you want to use. If you have used Webmorph [REF] to delineate, you can find a tutorial on how to convert your templates into the <code>geomorph</code>-friendly TPS format <a href=".%5CTEMtoTPS.html">here</a>.</p>
<p>For this tutorial, we will use <code>geomorph</code> to explore the Face Research Lab London Set [REF]. Start by loading the TPS file.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="va">path_to_tps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"LondonSet.tps"</span>, package<span class="op">=</span><span class="st">"facefuns"</span><span class="op">)</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geomorph/man/readland.tps.html">readland.tps</a></span><span class="op">(</span><span class="va">path_to_tps</span>, specID <span class="op">=</span> <span class="st">"ID"</span>, warnmsg <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></pre></div>
<p>It is always a good idea to start with plotting your data. This will show you straight away if there any obvious problems, for example, if you accidentally deleted landmarks you actually meant to keep.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/pkg/geomorph/man/plotAllSpecimens.html">plotAllSpecimens</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>The black dots show the sample average, the gray points represent individual faces. As you can see, there is a lot of “noise” in the individual data - some of this variation will be due to differences in the size of delineated faces (e.g., some peoples’ faces might just be overall bigger, but it could also be that some people were slightly closer to the camera), their position on screen (e.g., some people’s faces might have been a bit more in the center of the captured image than others), and their rotation (e.g., some people might have been tilting their face slightly to the left or right). We are not interested in that sort of variation, but seek to eliminate it - Generalized Procrustes alignment does exactly that!</p>
</div>
<div id="generalized-procrustes-analysis-gpa" class="section level2">
<h2 class="hasAnchor">
<a href="#generalized-procrustes-analysis-gpa" class="anchor"></a>Generalized Procrustes Analysis (GPA)</h2>
<p>We’ll use <code>geomporph</code> to Procrustes align our data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="va">data_gpa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geomorph/man/gpagen.html">gpagen</a></span><span class="op">(</span><span class="va">data</span>, print.progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></pre></div>
<p>The aligned coordinates are stored in <code>data_gpa$coords</code>. Let’s plot one of the aligned faces.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">data_gpa</span><span class="op">$</span><span class="va">coords</span><span class="op">[</span>, , <span class="fl">1</span><span class="op">]</span>, asp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>The GPA will sometimes rotate landmark templates, but this can be easily fixed by rotating them back into the right position.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="va">data_aligned</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geomorph/man/rotate.coords.html">rotate.coords</a></span><span class="op">(</span><span class="va">data_gpa</span><span class="op">$</span><span class="va">coords</span>,
                              type <span class="op">=</span> <span class="st">"rotateC"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">data_aligned</span><span class="op">[</span>, , <span class="fl">1</span><span class="op">]</span>, asp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Better. Let’s have another look at the whole sample again.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/pkg/geomorph/man/plotAllSpecimens.html">plotAllSpecimens</a></span><span class="op">(</span><span class="va">data_aligned</span><span class="op">)</span></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Much less messy! What we are left with after the GPA is actual <em>shape</em> data - data that is free of variation due to differences in size, location and orientation between individual subjects.</p>
</div>
<div id="shape-pca" class="section level2">
<h2 class="hasAnchor">
<a href="#shape-pca" class="anchor"></a>Shape PCA</h2>
<p>You might want to explore which shape dimensions explain the most variance in your data. Or, you might just be keen to get out principal component scores for each face for use in subsequent analyses.</p>
<p>The <code>geomorph</code> function for conducting a shape PCA is <code>gm.prcomp</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="va">pca_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geomorph/man/gm.prcomp.html">gm.prcomp</a></span><span class="op">(</span><span class="va">data_aligned</span><span class="op">)</span>
<span class="co"># summary(pca_output)</span></pre></div>
<p><code><a href="https://rdrr.io/r/base/summary.html">summary(data_PCA)</a></code> will return a list of <em>all</em> principal components. That is usually not what we want. Instead, we will use the <code><a href="../reference/selectPCs.html">facefuns::selectPCs</a></code> to decide which PCs we would like to retain for subsequent analyses.</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="va">london_pcs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/selectPCs.html">selectPCs</a></span><span class="op">(</span><span class="va">pca_output</span><span class="op">)</span></pre></div>
<p><code>selectPCs</code> returns a list of principal components as chosen by one of three methods. It defaults to the most conservative “broken_stick”method. Other methods are “Kaiser_Guttman” (retains PCs with eigenvalues greater than the mean eigenvalue) and “total_variance” (retains PCs explaining at least total_var variance). It returns three items: the number of selected PCs (<code>london_pcs$n</code>), their importance (<code>london_pcs$selected</code>) and the criterion that was used to choose PCs (<code>london_pcs$method</code>). The London Set has 8 selected PCs; the first three PCs explain 36.2%, 11.1% and 6.7% of variance, respectively.</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="va">london_pcs</span><span class="op">$</span><span class="va">selected</span>
<span class="co">#&gt;        SD Variance Cum Var</span>
<span class="co">#&gt; PC1 0.046    0.362   0.362</span>
<span class="co">#&gt; PC2 0.026    0.111   0.474</span>
<span class="co">#&gt; PC3 0.020    0.067   0.541</span>
<span class="co">#&gt; PC4 0.018    0.058   0.599</span>
<span class="co">#&gt; PC5 0.018    0.056   0.655</span>
<span class="co">#&gt; PC6 0.017    0.050   0.705</span>
<span class="co">#&gt; PC7 0.014    0.033   0.739</span>
<span class="co">#&gt; PC8 0.013    0.027   0.766</span></pre></div>
<p>We will save the principal component scores for any subsequent analyses we might want to do.</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="va">LondonSet_scores</span> <span class="op">&lt;-</span> <span class="va">pca_output</span><span class="op">$</span><span class="va">x</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># tidy colnames</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename_with</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"Comp"</span>, <span class="st">"PC"</span>, <span class="va">.x</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># re-add IDs</span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a></span><span class="op">(</span>.before <span class="op">=</span> <span class="fl">1</span>, id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"_03.tem"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">london_pcs</span><span class="op">$</span><span class="va">n</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></pre></div>
<p>What do these PCs look like? We will visualize the first three PCs by first defining a reference face, and then plotting what that reference face looks like when one PC at a time is increased/decreased. We will use the sample average as reference.</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="va">ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geomorph/man/mshape.html">mshape</a></span><span class="op">(</span><span class="va">data_aligned</span><span class="op">)</span>
<span class="fu"><a href="../reference/plot2DPCs.html">plot2DPCs</a></span><span class="op">(</span><span class="va">pca_output</span>, <span class="va">ref</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-12-1.png" width="864" style="display: block; margin: auto;"></p>
</div>
<div id="big-function" class="section level1">
<h1 class="hasAnchor">
<a href="#big-function" class="anchor"></a>Big function</h1>
<p>[add info explaining EVERYTHING :), change help file accordingly/keep stuff consistent; also get rid off warning message from readland.tps in basics output]</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="va">path_to_tem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"tem"</span>, package<span class="op">=</span><span class="st">"facefuns"</span><span class="op">)</span>
<span class="va">remove_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">45</span><span class="op">:</span><span class="fl">50</span>, <span class="fl">100</span><span class="op">:</span><span class="fl">104</span>, <span class="fl">116</span><span class="op">:</span><span class="fl">125</span>, <span class="fl">146</span><span class="op">:</span><span class="fl">158</span>, <span class="fl">159</span><span class="op">:</span><span class="fl">164</span>,
                   <span class="fl">165</span><span class="op">:</span><span class="fl">170</span>, <span class="fl">171</span><span class="op">:</span><span class="fl">174</span>, <span class="fl">175</span><span class="op">:</span><span class="fl">179</span>, <span class="fl">184</span><span class="op">:</span><span class="fl">185</span><span class="op">)</span>

<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basics.html">basics</a></span><span class="op">(</span>path_to_data <span class="op">=</span> <span class="va">path_to_tem</span>,
            p <span class="op">=</span> <span class="fl">189</span>,
            remove_points <span class="op">=</span> <span class="va">remove_points</span>,
            rotate <span class="op">=</span> <span class="st">"rotateC"</span>, 
            plot <span class="op">=</span> <span class="cn">TRUE</span>,
            pc_criterion <span class="op">=</span> <span class="st">"broken_stick"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Negative landmark coordinates have been identified and imported as such.</span>
<span class="co">#&gt; If you want to treat them as NAs please set negNA = TRUE</span></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-13-1.png" width="700"> It is highly recommended you plot your PCs!!</p>
<p>Explain different options:</p>
<p>Use geomorph::plotRefToTarget() to * plot from geomorph::gm.prcomp output - visualizes PCs based on sample range * plot from our function’s output - visualize PCs based on (+/- 3) standard deviations * plot PCs at any SD using make2DPCs</p>
<p>Or use convenience functionplot2DPCs to create plot of pairs of any PC(s) at customizable level of SD</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Iris J Holzleitner, Lisa M DeBruine.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
